"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var form=document.getElementById("form"),list=document.querySelector(".list-group"),clearBtn=document.getElementById("btn-clear"),input=document.getElementById("addNewTask"),Task=function(){function Task(){_classCallCheck(this,Task)}return _createClass(Task,null,[{key:"createTask",value:function createTask(task){fetch("https://ratatype-c2d32.firebaseio.com/tasks.json",{method:"POST",body:JSON.stringify(task),headers:{"Content-Type":"application/json;"}}).then((function(response){return response.ok?response.json():response.json().then((function(err){var e=new Error("Упс! Что то пошло не так!");throw e.data=err,e}))})).then((function(data){return task.id=data.name,task})).then(setToLocalStorage).then(Task.renderList).catch((function(err){console.log(err)})).finally(loading)}},{key:"renderList",value:function renderList(){var tasks=getFromLocalStorage(),liItem=null;tasks.length?(liItem=tasks.map(toList).join(""),clearBtn.disabled="",input.removeEventListener("keydown",animateEmptyList),clearBtn.addEventListener("click",Task.allClear,{once:!0})):(liItem='<li class="list-group-item justify-content-center align-items-center listEmpty">\n            <img src="img/norm.svg" alt="Смайлик" class="emoji">\n            <span class="task-title">Этот список пуст, как и твоя душа!</span>\n            </li>',clearBtn.removeEventListener("click",Task.allClear),input.addEventListener("keydown",animateEmptyList),clearBtn.disabled=!0),list.innerHTML=liItem}},{key:"delete",value:function _delete(id){fetch("https://ratatype-c2d32.firebaseio.com/tasks/".concat(id,".json"),{method:"DELETE",body:id,headers:{"Content-Type":"application/json;"}}).then(deleteTask(id)).then(Task.renderList)}},{key:"allClear",value:function allClear(){loading(),fetch("https://ratatype-c2d32.firebaseio.com/tasks.json",{method:"DELETE"}).then((function(){localStorage.removeItem("tasks"),Task.renderList()})).finally(loading)}},{key:"done",value:function done(id){fetch("https://ratatype-c2d32.firebaseio.com/tasks/".concat(id,".json"),{method:"PATCH",body:JSON.stringify({done:!0}),headers:{"Content-Type":"application/json;"}}).then(doneTask(id)).then(Task.renderList)}}]),Task}();function addTask(e){e.preventDefault();var task=document.getElementById("addNewTask");loading(),Task.createTask({text:task.value.trim(),date:new Date,done:!1}),task.focus(),form.reset()}function toList(task){return task.done?'<li class="list-group-item d-flex justify-content-between list-group-item-success">\n        <span class="task-title"><span class="strike">'.concat(task.text,'</span><small class="date">').concat(new Date(task.date).toLocaleDateString()," ").concat(new Date(task.date).toLocaleTimeString(),'</small></span>\n        <div data-id="').concat(task.id,'">\n            <button type="button" data-action="delete-task" class="btn btn-light align-self-end">Удалить</button>\n        </div>\n        </li>'):'<li class="list-group-item d-flex justify-content-between">\n    <span class="task-title">'.concat(task.text,'<small class="date">').concat(new Date(task.date).toLocaleDateString()," ").concat(new Date(task.date).toLocaleTimeString(),'</small></span>\n    <div data-id="').concat(task.id,'">\n        <button type="button" data-action="done-task" class="btn btn-light align-self-end">Готово</button>\n        <button type="button" data-action="delete-task" class="btn btn-light align-self-end">Удалить</button>\n    </div>\n    </li>')}function action(event){var target=event.target;if("delete-task"===target.dataset.action){var id=target.parentElement.dataset.id;Task.delete(id)}else if("done-task"===target.dataset.action){var _id=target.parentElement.dataset.id;Task.done(_id)}}function deleteTask(id){var all=getFromLocalStorage();all.splice(all.findIndex((function(task){return task.id===id})),1),localStorage.setItem("tasks",JSON.stringify(all))}function doneTask(id){var all=getFromLocalStorage();all.map((function(item){item.id===id&&(item.done=!0)})),localStorage.setItem("tasks",JSON.stringify(all))}function loading(){var loading=document.querySelector(".loading");if(loading.children.length>0)return loading.textContent="",void(loading.style.display="none");loading.insertAdjacentHTML("afterbegin",'<img src="img/loading.gif" alt="" class="loading__img">'),loading.style.display="flex"}function setToLocalStorage(task){var all=getFromLocalStorage();all.push(task),localStorage.setItem("tasks",JSON.stringify(all))}function getFromLocalStorage(){return JSON.parse(localStorage.getItem("tasks")||"[]")}function animateEmptyList(event){var emoji=document.getElementsByClassName("emoji")[0],emptyTitle=document.getElementsByClassName("task-title")[0];"Backspace"===event.key?(emoji.src="img/backspace.svg",emptyTitle.textContent="Остановись унтерменш! Noooooo",event.target.value.length<2&&setTimeout((function(){emoji.src="img/norm.svg",emptyTitle.textContent="Этот список пуст, как и твоя душа!"}),2e3)):(emoji.src="img/open.svg",emptyTitle.textContent="Идет набор текста...")}window.addEventListener("load",Task.renderList),form.addEventListener("submit",addTask),list.addEventListener("click",action.bind(void 0));
//# sourceMappingURL=main.js.map
